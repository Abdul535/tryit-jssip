/***
Copyright (c) 2013-2016, callstats.io
All rights reserved.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE
LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
POSSIBILITY OF SUCH DAMAGE.
***/

/*! callstats.js  version = 3.16.9 2016-11-09 */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){(function(b){"use strict";!function(){function c(){function b(){var a=(Math.random()+1).toString(36);return a.substring(2,a.length)}function c(){return window.performance.now?window.performance.now()+window.performance.timing.navigationStart:Date.now()}function d(){var a=c();return a+Qa.currentOffset}function e(){return window.performance.now?window.performance.now():null}function f(){"function"==typeof navigator.getBattery&&navigator.getBattery().then(function(a){ma=a})}function g(){return ma?ma.level:void 0}function h(){return ma?ma.charging:void 0}function i(){navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&navigator.mediaDevices.enumerateDevices().then(function(a){la=a})}function j(){za||window.addEventListener("beforeunload",function(a){var b;for(b in Oa)Oa.hasOwnProperty(b)&&Nb(_a.userLeft,null,b,Oa[b].ucID,null,null,null);return"Are you sure you want to close the call?"})}function k(a,b){setTimeout(function(){var b=d(),c=b-a.data.apiTS;a.data.timeShift=c,fa(a.channel,a.data,a.callback)},b)}function l(a,b,c,d,f){var g=Zb(c,d),h=null;g&&(h=e(),Nb(_a.mediaPlaybackStartEvent,b,c,a,{ssrc:f,highResTs:h},g,null))}function m(a,b,c,d,f){var g=Zb(c,d),h=null;g&&(h=e(),Nb(_a.mediaSuspendedEvent,b,c,a,{ssrc:f,highResTs:h},g,null))}function n(a,b,c,d,e){var f=document.getElementById(c);if(f){var g=Oa[b].ucID;f.oncanplay=function(){l(g,a,b,d,e)},f.onsuspend=function(){m(g,a,b,d,e)}}}function o(a){var b=La.codebase,c=!1;if(null===a)c=!1;else if(b===sb.firefox){var d=typeof mozRTCPeerConnection,e=typeof RTCPeerConnection;"undefined"!==d&&a instanceof mozRTCPeerConnection?c=!0:"undefined"!==e&&a instanceof RTCPeerConnection&&(c=!0)}else null!==Za&&a instanceof Za&&(c=!0),("function"==typeof a||b===sb.edge)&&(c=!0),void 0!==typeof a.createOffer&&(c=!0);return c}function p(a,b){var c;return a&&(b===sb.chrome?(c=a.googLocalAddress,c.concat(":",a.googRemoteAddress)):b===sb.firefox&&(c=a.localAddr,c.concat(":",a.remoteAddr))),Tb(c)}function q(){var a;return a=navigator.onLine===!0?"online":"offline"}function r(a,b){var c=tb.unknown,d=null;if(a&&a.data&&void 0!==a.data.mediaType)c=a.data.mediaType;else if(b===sb.chrome)void 0!==a&&(void 0!==a.data.googFrameRateReceived||void 0!==a.data.googFrameRateSent?c=tb.video:(void 0!==a.data.audioInputLevel||void 0!==a.data.audioOutputLevel)&&(c=tb.audio),d=a.data.googCodecName);else{if(b!==sb.firefox)return;void 0!==a&&void 0!==a.data.framerateMean&&(c=tb.video)}return Ta.hasOwnProperty(a.data.ssrc)&&(Ta[a.data.ssrc].mediaType=c,Ta[a.data.ssrc].codec=d),c}function s(a,b){var c;return b===sb.chrome?void 0!==a.data.googFrameRateOutput?c=parseInt(a.data.googFrameRateOutput,10):void 0!==a.data.googFrameRateDecoded?c=parseInt(a.data.googFrameRateDecoded,10):void 0!==a.data.googFrameRateReceived?c=parseInt(a.data.googFrameRateReceived,10):void 0!==a.data.googFrameRateSent&&(c=parseInt(a.data.googFrameRateSent,10)):b===sb.firefox&&void 0!==a.data.framerateMean&&(c=parseInt(a.data.framerateMean,10)),void 0!==c&&(c=isNaN(c)||0>c?null:c),c}function t(a,b){var c="unavailable";if(b===sb.chrome){var d,e,f;d=s(a,b),void 0!==a.data.googFrameWidthReceived?f=a.data.googFrameWidthReceived:void 0!==a.data.googFrameWidthSent&&(f=a.data.googFrameWidthSent),void 0!==a.data.googFrameHeightReceived?e=a.data.googFrameHeightReceived:void 0!==a.data.googFrameHeightSent&&(e=a.data.googFrameHeightSent),void 0!==d&&void 0!==f&&void 0!==e&&f>0&&e>0&&(c=f.concat("x",e,"@",d))}else b===sb.firefox;return c}function u(a,b){var c;return b===sb.chrome?void 0!==a.data.googFrameWidthReceived?c=a.data.googFrameWidthReceived:void 0!==a.data.googFrameWidthSent&&(c=a.data.googFrameWidthSent):b===sb.firefox,c}function v(a){var b;return b=isNaN(a)||0>a?null:a}function w(a,b){var c;if(b===sb.chrome){if(void 0!==a&&void 0!==a.data.googRtt)return c=v(parseInt(a.data.googRtt,10))}else if(b===sb.firefox){if(void 0!==a&&void 0!==a.data.mozRtt)return c=v(parseInt(a.data.mozRtt,10))}else if(b===sb.edge&&a&&a.data.roundTripTime)return c=v(parseInt(a.data.roundTripTime,10))}function x(a){var b=isNaN(a)?null:a;return b}function y(a,b){var c;if(b===sb.chrome){if(void 0!==a&&void 0!==a.data.googJitterReceived)return c=x(parseInt(a.data.googJitterReceived,10)),c&&(c/=1e3),c}else if(b===sb.firefox&&void 0!==a&&void 0!==a.data.jitter)return c=x(parseInt(a.data.jitter,10))}function z(a,b){if(b.sort(),b.length>0){var c=a/100*b.length;c=Math.ceil(c);var d=b[c-1];return d}}function A(a,b,c){var d;return b===tb.audio?a<c.audio.gThreshold?d=ib.excellent:a>c.audio.gThreshold&&a<c.audio.rThreshold?d=ib.fair:a>c.audio.rThreshold&&(d=ib.bad):b===tb.video&&(a<c.video.gThreshold?d=ib.excellent:a>c.video.gThreshold&&a<c.video.rThreshold?d=ib.fair:a>c.video.rThreshold&&(d=ib.bad)),d}function B(a,b,c){var d;return b===tb.audio?a>c.audio.gThreshold?d=ib.excellent:a>c.audio.rThreshold&&a<c.audio.gThreshold?d=ib.fair:a<c.audio.rThreshold&&(d=ib.bad):b===tb.video&&(a>c.video.gThreshold?d=ib.excellent:a>c.video.rThreshold&&a<c.video.gThreshold?d=ib.fair:a<c.video.rThreshold&&(d=ib.bad)),d}function C(){var a,b,c=0,d=0;for(a=0;a<arguments.length;a++)void 0!==arguments[a]&&null!==arguments[a]&&(c+=arguments[a],d++);return d>0&&(c/=d,c=Math.floor(c),c===ib.excellent?b=jb.excellent:c===ib.fair?b=jb.fair:c===ib.bad&&(b=jb.bad)),b}function D(a,b,c){var d,e,f,g,h,i,j,k,l=[];if(void 0!==a.lastStatsSent&&void 0!==a.lastStatsSent.statistics.Transport)for(f=a.lastStatsSent.statistics.Transport,g=a.latestEventSent,h=void 0,d=0;d<b.length;d++){for(h=void 0,e=0;e<f.length;e++)if(b[d].hash===f[e].hash){h=f[e];break}void 0!==h&&(i=parseInt(h.bytesReceived,10),j=parseInt(h.bytesSent,10),k=c-g,k>0&&(b[d].csioReceivedBwKbps=8*(parseInt(b[d].bytesReceived,10)-i)/k,b[d].csioSentBwKbps=8*(parseInt(b[d].bytesSent,10)-j)/k,b[d].csioIntBytesReceived=parseInt(b[d].bytesReceived,10)-i,b[d].csioIntBytesSent=parseInt(b[d].bytesSent,10)-j,void 0!==h.packetsSent&&void 0!==b[d].packetsSent&&(b[d].csioSentPacketRate=(parseInt(b[d].packetsSent,10)-parseInt(h.packetsSent,10))/(k/1e3),b[d].csioIntPacketsSent=parseInt(b[d].packetsSent,10)-parseInt(h.packetsSent,10)),void 0!==h.packetsReceived&&void 0!==b[d].packetsReceived&&(b[d].csioReceivedPacketRate=(parseInt(b[d].packetsReceived,10)-parseInt(h.packetsReceived,10))/(k/1e3),b[d].csioIntPacketsReceived=parseInt(b[d].packetsReceived,10)-parseInt(h.packetsReceived,10))),l.push(b[d]))}return l}function E(a,b,c,d){var e=[];return c===sb.firefox?e=null:c===sb.chrome&&(e=D(a,b,d)),e}function F(a){if(a=x(a),null!==a){var b=0>a?null:a;return b}}function G(a,b,c,d,e,f,g){return void 0===a[c]&&(a[c]={}),void 0===a[c].streams&&(a[c].streams={}),void 0===a[c].streams[b]&&(a[c].streams[b]={}),void 0===a[c].streams[b][e]&&(a[c].streams[b][e]={}),void 0===a[c].streams[b][e][d]&&(a[c].streams[b][e][d]={}),void 0===a[c].streams[b][e][d].totalTimeMs&&(g?a[c].streams[b][e][d][f]=[]:a[c].streams[b][e][d][f]=0),a}function H(a,b,c,d,e,f,g){var h,i,j,k,l,m,n,o,p,q,v,y,D,E,H,I,K,L,M,N,O,P,Q=null,R=null,S=null,T=b.reportType,U=null,V=null,W=null,X=null,Y=null,Z=null,$=null,_=null,aa=null,ba=b.data,ca=J(c.streams,b.ssrc,"outbound",T);ca?(h=x(parseInt(ca.data.bytesSent,10)),i=a.lastStatsSent.apiTS,H=x(parseInt(ca.data.packetsSent,10)),K=x(parseInt(ca.data.packetsLost,10)),L=x(parseInt(ca.data.discardedPackets,10))):(h=0,i=e,K=0,H=0,L=0),k=e,y=k-i,m=r(b,d),n=t(b,d),o=s(b,d),p=u(b,d),l=w(b,d),j=x(parseInt(ba.bytesSent,10)),null!==j&&null!==h&&h>j&&(h=0,Ab(va,wa,"log",{msg:"getstats: curBytesSent < prevBytesSent counter reset",conferenceID:f,ucID:g})),void 0!==ba.droppedFrames&&(M=F(parseInt(ba.droppedFrames,10)),null!==M&&null!==L&&L>M&&(L=0),null!==M&&null!==L&&(N=M-L)),I=F(parseInt(ba.packetsLost,10)),null!==I&&null!==K&&(R=I-K),E=F(parseInt(ba.packetsSent,10)),null!==E&&null!==H&&(D=E-H),void 0!==R&&void 0!==D&&D+R>0&&(S=R/(D+R)),y>0&&(null!==j&&null!==h&&(Q=8*(j-h)/y),void 0!==D&&(aa=D/(y/1e3)));var da=b.ssrc;a=G(a,da,"rttInfo",T,"outbound","rttArray",!0),a=G(a,da,"fractionalLossInfo",T,"outbound","fractionalLossArray",!0),a=G(a,da,"timeElapse",T,"outbound","totalTimeMs",!1),a=G(a,da,"frameWidthInfo",T,"outbound","frameWidthArray",!0),a=G(a,da,"frameRateInfo",T,"outbound","frameRateArray",!0),void 0!==l&&null!==l&&a.rttInfo.streams[da].outbound[T].rttArray.push(parseInt(l,10)),void 0!==S&&null!==S&&a.fractionalLossInfo.streams[da].outbound[T].fractionalLossArray.push(S),void 0!==o&&null!==o&&a.frameRateInfo.streams[da].outbound[T].frameRateArray.push(parseInt(o,10)),void 0!==p&&null!==p&&a.frameWidthInfo.streams[da].outbound[T].frameWidthArray.push(parseInt(p,10)),U=z(95,a.rttInfo.streams[da].outbound[T].rttArray),X=z(95,a.fractionalLossInfo.streams[da].outbound[T].fractionalLossArray),null!==j&&null!==h&&j>h&&(a.timeElapse.streams[da].outbound[T].totalTimeMs=a.timeElapse.streams[da].outbound[T].totalTimeMs+y),a.timeElapse.streams[da].outbound[T].totalTimeMs>0&&null!==j&&(_=8*j/a.timeElapse.streams[da].outbound[T].totalTimeMs);var ea={csioIntMs:y,csioIntFL:S,csioIntPR:aa,csioIntBRKbps:Q,csioMediaType:m,csioSig2Latency:U,csioAvgBRKbps:_,csioTimeElapseMs:a.timeElapse.streams[da].outbound[T].totalTimeMs,csioRes:n,csioPercentileFl:X,csioIntFramesDropped:N};for(O in ba)ba.hasOwnProperty(O)&&(ea[O]=ba[O]);return m===tb.audio?(P=U+40,V=A(P,m,rb),W=B(Q,m,nb),q=C(V,W),ea.csioMark=q,ea.csioeM=P):m===tb.video&&(ea.csioPercentileFrameWidth=z(95,a.frameWidthInfo.streams[da].outbound[T].frameWidthArray),ea.csioPercentileFrameRate=z(95,a.frameRateInfo.streams[da].outbound[T].frameRateArray),v=parseInt(a.rttInfo.streams[da].outbound[T].frameRate,10),Y=B(o/v,m,ob),Z=A(l,m,pb),$=B(Q,m,nb),q=C(Y,Z,$),a.rttInfo.streams[da].outbound[T].frameRate=o,ea.csioMark=q),ea}function I(a,b,c,d,e,f,g){var h,i,j,k,l,m,n,o,p,q,v,D,E,H,I,K,L,M,N,O,P,Q,R,S,T,U,V=null,W=null,X=b.reportType,Y=null,Z=null,$=null,_=null,aa=null,ba=null,ca=null,da=null,ea=null,fa=b.data,ga=J(c.streams,b.ssrc,"inbound",X);ga?(h=x(parseInt(ga.data.bytesReceived,10)),l=x(parseInt(ga.data.packetsLost,10)),O=x(parseInt(ga.data.packetsReceived,10)),i=a.lastStatsSent.apiTS,Q=x(parseInt(ga.data.discardedPackets,10))):(h=0,i=e,l=0,O=0,Q=0),o=r(b,d),p=t(b,d),v=s(b,d),q=y(b,d),U=u(b,d),n=w(b,d),j=x(parseInt(fa.bytesReceived,10)),null!==j&&null!==h&&h>j&&(h=0,l=0,O=0,Ab(va,wa,"log",{msg:"getstats: curBytesReceived < prevBytesReceived counter reset",conferenceID:f,ucID:g})),m=F(parseInt(fa.packetsLost,10)),null!==m&&null!==l&&(W=m-l),k=e,void 0!==fa.discardedPackets&&(P=F(parseInt(fa.discardedPackets,10)),null!==P&&null!==Q&&Q>P&&(Q=0),null!==P&&null!==Q&&(R=P-Q)),N=F(parseInt(fa.packetsReceived,10)),D=N-O,void 0!==W&&null!==D&&D+W>0&&(Z=W/(D+W)),M=k-i,M>0&&(null!==j&&null!==h&&(V=8*(j-h)/M),null!==D&&(Y=D/(M/1e3)));var ha=b.ssrc;a=G(a,ha,"rttInfo",X,"inbound","rttArray",!0),a=G(a,ha,"timeElapse",X,"inbound","totalTimeMs",!1),a=G(a,ha,"jitterInfo",X,"inbound","jitterArray",!0),a=G(a,ha,"fractionalLossInfo",X,"inbound","fractionalLossArray",!0),a=G(a,ha,"frameWidthInfo",X,"inbound","frameWidthArray",!0),a=G(a,ha,"frameRateInfo",X,"inbound","frameRateArray",!0),void 0!==n&&null!==n&&a.rttInfo.streams[ha].inbound[X].rttArray.push(parseInt(n,10)),void 0!==q&&null!==q&&a.jitterInfo.streams[ha].inbound[X].jitterArray.push(parseInt(q,10)),void 0!==Z&&null!==Z&&a.fractionalLossInfo.streams[ha].inbound[X].fractionalLossArray.push(Z),void 0!==v&&null!==v&&a.frameRateInfo.streams[ha].inbound[X].frameRateArray.push(parseInt(v,10)),void 0!==U&&null!==U&&a.frameWidthInfo.streams[ha].inbound[X].frameWidthArray.push(parseInt(U,10)),$=z(95,a.rttInfo.streams[ha].inbound[X].rttArray),_=z(95,a.jitterInfo.streams[ha].inbound[X].jitterArray),aa=z(95,a.fractionalLossInfo.streams[ha].inbound[X].fractionalLossArray),null!==j&&null!==h&&j>h&&(a.timeElapse.streams[ha].inbound[X].totalTimeMs=a.timeElapse.streams[ha].inbound[X].totalTimeMs+M),null!==j&&a.timeElapse.streams[ha].inbound[X].totalTimeMs>0&&(ea=8*j/a.timeElapse.streams[ha].inbound[X].totalTimeMs);var ia={csioIntMs:M,csioIntFL:Z,csioIntPR:Y,csioIntBRKbps:V,csioSig2Latency:$,csioAvgBRKbps:ea,csioMediaType:o,csioTimeElapseMs:a.timeElapse.streams[ha].inbound[X].totalTimeMs,csioIntPktRcv:D,csioIntPktLoss:W,csioPercentileJitter:_,csioRes:p,csioPercentileFl:aa,csioIntPktDiscarded:R};for(S in fa)fa.hasOwnProperty(S)&&(ia[S]=fa[S]);return o===tb.audio?(T=$+40,ba=A(T,o,rb),ca=A(Z,o,qb),da=B(V,o,nb),E=C(ba,ca,da),ia.csioMark=E,ia.csioeM=T):o===tb.video&&(ia.csioPercentileFrameRate=z(95,a.frameRateInfo.streams[ha].inbound[X].frameRateArray),ia.csioPercentileFrameWidth=z(95,a.frameWidthInfo.streams[ha].inbound[X].frameWidthArray),H=a.rttInfo.streams[ha].inbound[X].frameRate,I=B(v/H,o,ob),K=A(n,o,pb),L=B(V,o,nb),E=C(I,K,L),a.rttInfo.streams[ha].inbound[X].frameRate=v,ia.csioMark=E),ia}function J(a,b,c,d){var e=a.filter(function(a){return a.ssrc===b&&a.streamType===c&&a.reportType===d});return e.length>0?e[0]:null}function K(a,b,c,d,e,f){var g={streams:[]};g.fabricState=a.pcState,g.connectionState=q();var h=null;return h=a.lastStatsSent?a.lastStatsSent.statistics:{streams:[]},b.streams.forEach(function(b){var i={cname:b.cname,usage:b.usage,msid:b.msid,userID:b.userID,associatedVideoTag:b.associatedVideoTag,ssrc:b.ssrc,streamType:b.streamType,reportType:b.reportType};"inbound"===b.streamType?i.data=I(a,b,h,c,d,e,f):i.data=H(a,b,h,c,d,e,f),g.streams.push(i)}),g}function L(a){var b,c,d;for(b in a.streams)if(a.streams.hasOwnProperty(b)){if(a.streams[b].inbound)for(d in a.streams[b].inbound)a.streams[b].inbound.hasOwnProperty(d)&&(c=a.streams[b].inbound[d].mark,c===jb.bad?a.streams[b].inbound[d].mark=2:c===jb.fair?a.streams[b].inbound[d].mark=1:a.streams[b].inbound[d].mark=0);if(a.streams[b].outbound)for(d in a.streams[b].outbound)a.streams[b].outbound.hasOwnProperty(d)&&(c=a.streams[b].outbound[d].mark,c===jb.bad?a.streams[b].outbound[d].mark=2:c===jb.fair?a.streams[b].outbound[d].mark=1:a.streams[b].outbound[d].mark=0)}return a}function M(a,b,c){var d,e,f;for(d=0;d<a.length;d++)e=b[a[d].localCandidateId],f=c[a[d].remoteCandidateId],a[d].localAddr=e.ipAddress+":"+e.portNumber,a[d].remoteAddr=f.ipAddress+":"+f.portNumber,a[d].localAddrType=e.candidateType,a[d].remoteAddrType=f.candidateType,a[d].transportType=e.transport;return a}function N(a){var b={},c=Dc.getConferenceURL();return a.connectionState&&(b.connectionState=a.connectionState),a.fabricState&&(b.fabricState=a.fabricState),c&&(b.conferenceURL=c),b.streams={},a.streams.forEach(function(a){var c={cname:a.cname,ssrc:a.ssrc,msid:a.msid,remoteUserID:a.userID,usageLabel:a.usage,associatedVideoTag:a.associatedVideoTag};"inbound"===a.streamType?(a.data.hasOwnProperty("csioIntFL")&&(c.fractionLoss=a.data.csioIntFL),a.data.hasOwnProperty("csioIntBRKbps")&&(c.bitrate=a.data.csioIntBRKbps),a.data.hasOwnProperty("csioMark")&&(c.quality=a.data.csioMark),a.data.hasOwnProperty("csioMediaType")&&(c.mediaType=a.data.csioMediaType),a.data.hasOwnProperty("googRtt")&&(c.rtt=a.data.googRtt),a.data.hasOwnProperty("mozRtt")&&(c.rtt=a.data.mozRtt),a.data.hasOwnProperty("roundTripTime")&&(c.rtt=a.data.roundTripTime),a.data.hasOwnProperty("jitter")&&(c.jitter=a.data.jitter),a.data.hasOwnProperty("googJitterReceived")&&(c.jitter=a.data.googJitterReceived),a.data.hasOwnProperty("audioOutputLevel")&&(c.audioOutputLevel=a.data.audioOutputLevel),a.data.hasOwnProperty("audioInputLevel")&&(c.audioInputLevel=a.data.audioInputLevel)):(a.data.hasOwnProperty("csioIntFL")&&(c.fractionLoss=a.data.csioIntFL),a.data.hasOwnProperty("csioIntBRKbps")&&(c.bitrate=a.data.csioIntBRKbps),a.data.hasOwnProperty("csioMark")&&(c.quality=a.data.csioMark),a.data.hasOwnProperty("csioMediaType")&&(c.mediaType=a.data.csioMediaType),a.data.hasOwnProperty("googRtt")&&(c.rtt=a.data.googRtt),a.data.hasOwnProperty("mozRtt")&&(c.rtt=a.data.mozRtt),a.data.hasOwnProperty("roundTripTime")&&(c.rtt=a.data.roundTripTime),a.data.hasOwnProperty("jitter")&&(c.jitter=a.data.jitter),a.data.hasOwnProperty("googJitterReceived")&&(c.jitter=a.data.googJitterReceived),a.data.hasOwnProperty("audioInputLevel")&&(c.audioInputLevel=a.data.audioInputLevel),a.data.hasOwnProperty("audioOutputLevel")&&(c.audioOutputLevel=a.data.audioOutputLevel)),b.streams[a.ssrc]=c}),b}function O(a,b,c,e,f,g){var h=d();a.hasOwnProperty("token")&&a.hasOwnProperty("ucID")&&!Ra?(fa(ab.processedStats,a,g),b.latestEventSent=h,b.lastFabricState=b.pcState):(a.clockUnsynced=Ra,Ib({channel:ab.processedStats,data:a}),a.hasOwnProperty("token")||Ja.sendAuthenticationRequest(va,f))}function P(a,b,e,f,i,j,k){function l(l){var m=d(),n=c();void 0===j.lastRawStatsSentInterval||null===j.lastRawStatsSentInterval?j.lastRawStatsSentInterval=n-j.statsPollingStart:j.lastRawStatsSentInterval=n-j.rawstatsTS+j.lastRawStatsSentInterval,void 0===j.lastProcessedStatsSentInterval||null===j.lastProcessedStatsSentInterval?j.lastProcessedStatsSentInterval=n-j.statsPollingStart:j.lastProcessedStatsSentInterval=n-j.rawstatsTS+j.lastProcessedStatsSentInterval,j.rawstatsTS=n;var o={},q=La.codebase;o.version=ra,o.appID=va,o.conferenceID=encodeURIComponent(f),o.apiTS=m,o.timeShift=0,o.fabricState=j.pcState,o.pcID=j.pcHash,void 0!==i&&(o.ucID=i),Ja.authToken?o.token=Ja.authToken:Ja.sendAuthenticationRequest(va,b),o.localID=encodeURIComponent(b),o.remoteID=encodeURIComponent(e),o.deviceID=ya;var r,s,t,u,v,w,x,y={streams:[]},z=null,A=!1,B=!1,C={},D={};for(z=ac(l),r=0;r<z.length;++r)if(s=U(z[r]),t=R(JSON.parse(s),q),!V(t))if(t.hasOwnProperty("Transport"))u="Transport",y.hasOwnProperty(u)||(y[u]=[]),q!==sb.firefox?(parseInt(t[u].bytesReceived,10)>0||parseInt(t[u].bytesSent,10)>0)&&(y[u].push(t[u]),"true"===t[u].googActiveConnection&&(o.activeConnectionIndex=y[u].length)):(y[u].push(t[u]),"true"===t[u].selected&&(o.activeConnectionIndex=y[u].length));else if(t.hasOwnProperty("localCandidate"))C[t.localCandidate.id]=t.localCandidate;else if(t.hasOwnProperty("remoteCandidate"))D[t.remoteCandidate.id]=t.remoteCandidate;else if(t.hasOwnProperty("bwe"))y.bwe=t.bwe;else{w=Kb(t.ssrc),void 0!==w&&w.localStartTime||(x=Mb(e,f,i,j,k,null),x&&(B=!0),w=Kb(t.ssrc)),w&&(v=w.remoteUserID),void 0===v&&(v=e);var F={userID:v,data:t.data,reportType:t.reportType,streamType:t.streamType,ssrc:t.ssrc};void 0!==w&&(F.cname=w.cname,F.msid=w.msid,F.associatedVideoTag=w.associatedVideoTag,F.usage=w.usageLabel),y.streams.push(F)}q===sb.firefox&&(y.Transport=M(y.Transport,C,D));var G;if(y.Transport)for(G=0;G<y.Transport.length;G++)y.Transport[G].hash=p(y.Transport[G],q);o.statistics=y,y.Transport&&(A=T(y.Transport,j)),A&&fc(k,_a.updatedConfiguration,f),j.pcState===kb.disrupted&&Y(o);var H=K(j,y,q,m,f,i);if(y.Transport&&(H.Transport=E(j,y.Transport,q,m)),y.bwe&&(H.bwe=y.bwe),void 0===j.processedStatsTupleArray&&(j.processedStatsTupleArray=[]),na){var I=N(H);na(I)}H.apiTS=m,H.batteryStatus={},H.batteryStatus.batteryLevel=g(),H.batteryStatus.isBatteryCharging=h(),H=L(H),j.processedStatsTupleArray.push(H),o.processedStatistics=j.processedStatsTupleArray,j.lastStatsSent=o;var J=ha(o),P=ha(o);delete J.processedStatistics,delete P.statistics,B&&Nb(_a.ssrcMap,e,f,i,Lb(),j.pcHash),(j.lastProcessedStatsSentInterval>=Ca||j.initialPhaseOver)&&(j.processedStatsTupleArray=[],O(P,j,f,e,b,a),j.lastProcessedStatsSentInterval=0)}return l}function Q(a){var b;return lb.hasOwnProperty(a)?a===lb.createOffer||a===lb.createAnswer||a===lb.setRemoteDescription?b=mb.negotiationFailure:a===lb.setLocalDescription?b=mb.sdpError:a===lb.addIceCandidate?b=mb.sdpError:a===lb.getUserMedia?b=mb.mediaConfigError:a===lb.iceConnectionFailure?b=mb.iceFailure:a===lb.signalingError?b=mb.signalingError:(a===lb.applicationLog||lb.applicationError)&&(b=mb.applicationLog):b=Bb.invalidWebRTCFunctionName,b}function R(a,b){var c={};return b===sb.firefox?"inboundrtp"===a.type||"outboundrtp"===a.type?(c.ssrc=a.ssrc,c.streamType="inboundrtp"===a.type?"inbound":"outbound",c.data=a,c.mediaType=a.mediaType,c.reportType="true"===a.isRemote?"remote":"local"):"candidatepair"===a.type&&a.selected?c.Transport=a:"localcandidate"===a.type?c.localCandidate=a:"remotecandidate"===a.type&&(c.remoteCandidate=a):b===sb.chrome?"ssrc"===a.type?(c.reportType="local",a.bytesSent?c.streamType="outbound":c.streamType="inbound",c.ssrc=a.ssrc,c.data=a):"googCandidatePair"===a.type?c.Transport=a:"localcandidate"===a.type?c.localCandidate=a:"remotecandidate"===a.type?c.remoteCandidate=a:"VideoBwe"===a.type&&(c.bwe=a):b===sb.edge&&("inbound-rtp"===a.type||"outbound-rtp"===a.type?(c.ssrc=a.ssrc,c.streamType="inbound-rtp"===a.type?"inbound":"outbound",c.data=a,c.reportType="local"):"transport"===a.type?c.Transport=a:"localcandidate"===a.type?c.localCandidate=a:"remotecandidate"===a.type&&(c.remoteCandidate=a)),c}function S(a){var b="None";switch(a){case 0:b="TURN/TLS";break;case 1:b="TURN/TCP";break;case 2:b="TURN/UDP"}return b}function T(a,b){var c,d,e,f,g,h,i,j,k=!1,l="None",m=!1,n=function(a){var b=a.typePreference>>24;return"rtp"===a.protocol&&a.address===c?(b>=0&&2>=b&&(l=S(b)),!0):!1};for(i=0;i<a.length;i++)if(j=a[i],navigator.mozGetUserMedia&&"candidatepair"===j.type&&"true"===j.selected?(m=!0,c=j.localAddr,d=j.remoteAddr,e=j.localAddrType,f=j.remoteAddrType,g=j.transportType):"googCandidatePair"===j.type&&"true"===j.googActiveConnection&&(m=!0,c=j.googLocalAddress,d=j.googRemoteAddress,e=j.googLocalCandidateType,f=j.googRemoteCandidateType,g=j.googTransportType),m){h=0===c.indexOf("["),b.iceCandidates.some(n);break}if(!m)return k;var o=b.transportData;return(void 0===o||o.localAddr!==c||o.remoteAddr!==d||o.localAddrType!==e||o.remoteAddrType!==f||o.transportType!==g)&&(b.transportData={localAddr:c,remoteAddr:d,localAddrType:e,remoteAddrType:f,transportType:g,ipv6:h,relayType:l},k=!0),k}function U(a){var b="";b+='{"Timestamp":"',b+=a.timestamp instanceof Date?a.timestamp.getTime().toString():a.timestamp,b+='",',a.type&&(b+='"type" : "'+a.type+'",');var c=0;if(a.names){var d=a.names();for(c=0;c<d.length;++c)b+='"',b+=d[c],b+='" : "',b+=a.stat(d[c]),b+='"',c+1!==d.length&&(b+=",")}else{var e=Object.keys(a).length;c=0;var f;for(f in a)a.hasOwnProperty(f)&&(c++,"timestamp"!==f&&(b+='"',b+=f,b+='" : "',b+=a[f],b+='"',e>c&&(b+=",")))}return b+="}"}function V(a){if(null===a)return!0;if(a.length>0)return!1;if(0===a.length)return!0;var b;for(b in a)if(a.hasOwnProperty(b))return!1;return!0}function W(a){return{magicKey:a,statsSubmissionInterval:Ea,endpoint:Na,localUserIDObject:xa}}function X(a,b,c){var d=Oa[a];void 0===d&&(Oa[a]={},Oa[a].participants=null,c&&(Oa[a].userJoinedSent=!0),b&&(Oa[a].refreshPresence=b))}function Y(a){var b,c=a.statistics.outbound;if(void 0!==c)for(b in c)c.hasOwnProperty(b)&&(navigator.mozGetUserMedia&&c[b].data.mozRtt?c[b].data.mozRtt=0:c[b].data.googRtt&&(c[b].data.googRtt=0))}function Z(a){return clearInterval(a),null}function $(){var a;for(a in Oa)Oa.hasOwnProperty(a)&&(Oa[a].refreshPresence=Z(Oa[a].refreshPresence),delete Oa[a].refreshPresence);ja()}function _(a){var b=Oa[a],c=!1;return void 0!==b&&b.participants&&b.participants.length>0&&(c=!0),c}function aa(a,b){var c=Oa[a],d=[];if(void 0===c)d.push(b),Oa[a].participants=d;else{var e=c.participants;null===e?(d.push(b),c.participants=d):e.push(b)}}function ba(a){var b=!1;if(!Oa[a])return{conferenceFinished:b,ucID:null};var c=Oa[a].ucID;return 0===Oa[a].participants.length&&(Z(Oa[a].refreshPresence),ja(),Gb(),delete Oa[a],b=!0),{conferenceFinished:b,ucID:c}}function ca(a,b){Nb(_a.userLeft,null,a,b,null,null,null),Va=Z(Va),ja(),Ua=Fb,Fb=null}function da(){var a,b=function(a){return setInterval(function(){Pb(a)},Ga)};for(a in Oa)Oa.hasOwnProperty(a)&&(Pb(a),Oa[a].refreshPresence=b(a));ka()}function ea(a){var b=JSON.parse(window.sessionStorage.getItem("csio_ucid_data"));return b[a]?b[a].ucID:null}function fa(a,b,c){var d=b.action;b.channel=a,Ja._isTokenValid(Ja.authToken,va,wa)?Ra&&-1===ub.indexOf(d)?(b.clockUnsynced=Ra,Ib({channel:a,data:b,callback:c})):(b.token=Ja.authToken,Ec(a,b,c),c&&c(cb.success,d+" sent to the backend.")):Ja.sendAuthenticationRequest(va,wa,function(e,f){e!==cb.success?(e===db.authOngoing&&(b.clockUnsynced=Ra,Ib({channel:a,data:b,callback:c})),c&&e!==db.authOngoing&&c(e,f)):e===cb.success&&"SDK authentication successful."===f&&(Ra&&-1===ub.indexOf(d)?(b.clockUnsynced=Ra,Ib({channel:a,data:b,callback:c})):(b.token=Ja.authToken,Ec(a,b,c),c&&c(cb.success,d+" sent to the backend.")))})}function ga(a){a&&a(db.authOngoing,null)}function ha(a){if(null===a||"object"!=typeof a)return a;var b,c=new a.constructor;for(b in a)a.hasOwnProperty(b)&&(c[b]=ha(a[b]));return c}function ia(){var a={};Object.keys(Oa).forEach(function(b){var c=Oa[b];if(!c)return!0;var d,e,f={ucID:c.ucID,userJoinedSent:c.userJoinedSent},g=[];if(c.participants){var h,i=c.participants;for(d=0;d<i.length;d++)e={},h=i[d],e={pcID:h.pcHash,pcState:h.pcState,iceConnectionState:h.iceConnectionState,iceGatheringState:h.iceGatheringState,iceCandidatesNumber:h.iceCandidates.length,remoteUserID:h.remoteUserID},g.push(e)}f.participants=g,a[b]=f});var b={authStatus:Ja.tokenData?!0:!1,clockSync:!Ra,stateMachine:a,pageURL:window.location.href,eventType:"warn",version:ra};b.wsStatus=Dc.getWSConnectionState(),Ab(va,wa,"stateMachine",b)}function ja(){Wa||(Wa=setInterval(function(){ia()},Xa))}function ka(){Z(Wa),Wa=null}var la,ma,na,oa=a("./callstatsUtils"),pa="https://collector.callstats.io:443/",qa="https://auth.callstats.io/",ra="3.16.9",sa="wss://collector.callstats.io:443/csiows/collectCallStats",ta="https://dashboard.callstats.io/apps/",ua="https://dashboard.callstats.io/api-internal/v1/qmodelthresholds",va=null,wa=null,xa=null,ya=null,za=!1,Aa=!1,Ba=3e4,Ca=1e4,Da=2e4,Ea=15e3,Fa=!1,Ga=1e4,Ha=5e3,Ia=function(){var a=this,b="urn:x-callstats:auth:errorActions",c=.9,e=3600;this.authInProgress=!1,this.tokenData=null,this.authToken=null,this.tokenGenerator=function(a,b){b("Token generator not set")};var f=null,g=null,h=!1,i=window.atob,j=window.btoa,k=function(a){return j(a).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=+$/,"")},l=function(a){for(var b=i(a.replace(/[ \r\n]+$/,"")),c=[],d=0;d<b.length;++d){var e=b.charCodeAt(d).toString(16);1===e.length&&(e="0"+e),c.push(e)}return c.join("")},m={};m.cryptotype=null,window.crypto&&window.crypto.subtle?(m.cryptotype="standard",m.subtlecrypto=window.crypto.subtle):window.crypto&&!window.crypto.subtle&&window.crypto.webkitSubtle?(m.cryptotype="webkit",m.subtlecrypto=window.crypto.webkitSubtle):window.msCrypto&&window.msCrypto.subtle?(m.cryptotype="ie",m.subtlecrypto=window.msCrypto.subtle):(m.subtlecrypto=null,console.info("WebCryptography API not supported in this browser.")),m.sign=function(a,b,c,d){if("HS256"!==a.alg)return d("Use header.alg=HS256");a=JSON.stringify(a),"string"!=typeof b&&(b=JSON.stringify(b));for(var e=k(a)+"."+k(b),f=new ArrayBuffer(e.length),g=new Uint8Array(f),h=e.length-1;h>=0;h--)g[h]=e.charCodeAt(h);var i=function(a){for(var b="",c=new Uint8Array(a),f=c.byteLength,g=0;f>g;g++)b+=String.fromCharCode(c[g]);return e+="."+k(b),d(null,e)},j=function(a){return d(a)},l={name:"HMAC"};("ie"===m.cryptotype||"webkit"===m.cryptotype)&&(l.hash={name:"sha-256"});var n=m.subtlecrypto.sign(l,c,g);"ie"===m.cryptotype?(n.onerror=j,n.oncomplete=function(a){i(a.target.result)}):n.then(i)["catch"](j)},m.decode=function(a){try{return JSON.parse(i(a.split(".")[1]))}catch(b){return null}},m.importKey=function(a,b,c){if("webkit"===m.cryptotype)for(;a.length<32;)a+="\x00";var d={kty:"oct",k:k(a),alg:"HS256"},e={name:"HMAC",hash:{name:"SHA-256"}};if("ie"===m.cryptotype?d.extractable=!1:d.ext=!1,"webkit"===m.cryptotype&&(e=null,d.use="sig"),"ie"===m.cryptotype||"webkit"===m.cryptotype){var f=JSON.stringify(d);d=new Uint8Array(f.length);for(var g=0;g<f.length;g++)d[g]=f.charCodeAt(g)}var h=m.subtlecrypto.importKey("jwk",d,e,!1,["sign"]);"ie"===m.cryptotype?(h.onerror=c,h.oncomplete=function(a){b(a.target.result)}):h.then(b)["catch"](c)},this._isTokenValid=function(a,b,c){var e=!1;if(null===a)return!1;try{var f=m.decode(a);if(null!==f&&f.appID===b&&f.userID===encodeURIComponent(c)){var g=null;if(navigator.mozGetUserMedia){var h=f.expiry.split(" ").join("T");g=Date.parse(h)}else g=new Date(f.expiry);var i=new Date(d());g>i&&(e=!0)}return e}catch(j){}return!1},this.setupAuthToken=function(a){vb("csio_auth_data",JSON.stringify(a)),this.authToken=a,this.tokenData=m.decode(a),Ea=parseInt(this.tokenData.submissionInterval,10),Fa=this.tokenData.collectSDP},this.sendAuthenticationRequest=function(d,e,g){if(d&&e){if(a.authInProgress)return void ga(g);null!==f&&(clearTimeout(f),f=null),n(),a.authInProgress=!0,a.tokenGenerator(h,function(i,j){if(null!==i)return a.authInProgress=!1,void(g&&g(cb.tokenGenerationError,i.toString()));var k=qa+"authenticate",l={client_id:e+"@"+va,code:j,grant_type:"authorization_code"};yc(k,l,function(i){var j=null;a.authInProgress=!1;try{j=JSON.parse(i.response)}catch(k){}if(!j)return void(f=setTimeout(a.sendAuthenticationRequest,Ha,d,e,g));if(200===i.status){if("bearer"!==j.token_type)return void(f=setTimeout(a.sendAuthenticationRequest,Ha,d,e,g));a.setupAuthToken(j.access_token);var l=parseInt(1e3*parseInt(j.expires_in)*c);o(l,d,e,g),h=!1,g&&g(cb.success,"SDK authentication successful."),Dc._isChannelReady()?(Hb(),g&&g(cb.success,"WebSocket establishment successful.")):Dc._setupWebSocketConnection(function(a,b){void 0!==g&&g(a,b)})}else{if(j[b]&&j[b].length>0)return p(d,e,g,j[b]);f=setTimeout(a.sendAuthenticationRequest,Ha,d,e,g)}})})}};var n=function(){null!==g&&(clearTimeout(g),g=null)},o=function(b,c,d,e){n(),g=setTimeout(function(){a.sendAuthenticationRequest(c,d,e)},b)},p=function(a,b,c,d){if(0!==d.length){var e=d.shift();return e.action===Cb.RETRY?(o(e.params.timeout,a,b,c),p(a,b,c,d)):e.action===Cb.GET_NEW_TOKEN?(h=!0,p(a,b,c,d)):e.action===Cb.REPORT_ERROR?p(a,b,c,d):void 0}};this.appSecretTokenGenerator=function(b){var c=null,f=null,g=!1,h=null;b.indexOf(":")>-1&&(h=l(b.split(":")[0]),b=b.split(":")[1]);var i=function(a){b=null,c=a},j=function(a){g=!0,b=null};return m.importKey(b,i,j),function(b,i){if(g)return i("appsecret based token generation failed");if(!b&&null!==f)return i(null,f);if(null===c)return setTimeout(function(){a.tokenGenerator(b,i)},100);var j={userID:wa,appID:va,exp:parseInt(d()/1e3)+e,nbf:parseInt(d()/1e3)-e};h&&(j.keyID=h),m.sign({alg:"HS256"},j,c,function(a,b){return a?i(a):(f=b,i(null,b))})}}},Ja=new Ia,Ka=new oa,La=Ka.detectBrowserInfo(),Ma=Ka.measureAppLoadingPerformance(La),Na={type:"browser",name:La.name,ver:La.ver,os:La.os,osVersion:La.osVersion,userAgent:La.userAgent},Oa={},Pa={statsSubmissionIntervalInMS:[1e3,2e3,5e3,1e4],statsSubmissionPhaseDurationInMS:[1e4,3e4,8e4,18e4],currentActivePhaseIndex:0},Qa={currentOffset:0,offsetResults:[],syncStartTime:null,syncAttempts:5,syncHandler:null,maxAllowedLatency:6e4},Ra=!0,Sa=[],Ta={},Ua=null,Va=null,Wa=null,Xa=2e4,Ya=100,Za=null;"Firefox"===La.name?Za=mozRTCPeerConnection:"Chrome"===La.name||"Opera"===La.name?Za=webkitRTCPeerConnection:"Safari"===La.name||"Edge"===La.name&&(Za=window.RTCPeerConnection);var $a={fabricSetup:"fabricSetup",fabricSetupFailed:"fabricSetupFailed",fabricHold:"fabricHold",fabricResume:"fabricResume",audioMute:"audioMute",audioUnmute:"audioUnmute",videoPause:"videoPause",videoResume:"videoResume",fabricUsageEvent:"fabricUsageEvent",fabricStats:"fabricStats",fabricTerminated:"fabricTerminated",screenShareStart:"screenShareStart",screenShareStop:"screenShareStop",dominantSpeaker:"dominantSpeaker",userIDChangedEvent:"userIDChangedEvent",activeDeviceList:"activeDeviceList",applicationErrorLog:"applicationErrorLog"},_a={fabricDisrupted:"fabricDisrupted",autoFabricSetup:"autoFabricSetup",autoFabricSetupFailed:"autoFabricSetupFailed",userJoined:"userJoined",userLeft:"userLeft",fabricStatsCaching:"fabricStatsCaching",updatedConfiguration:"updatedConfiguration",refreshPresence:"refreshPresence",
ssrcMap:"ssrcMap",mediaPlaybackStartEvent:"mediaPlaybackStartEvent",mediaSuspendedEvent:"mediaSuspendedEvent"},ab={sdpSubmission:"sdpSubmissionEvent",rtpStats:"rtpStats",processedStats:"processedStats",callStatsEvent:"callStatsEvent",registerPresence:"registerPresence",userFeedback:"userFeedbackEvent",clockSync:"clockSync"},bb={success:"success",failure:"failure"},cb={httpError:"httpError",authError:"authError",wsChannelFailure:"wsChannelFailure",success:"success",csProtoError:"csProtoError",appConnectivityError:"appConnectivityError",tokenGenerationError:"tokenGenerationError",ok:"OK"},db={authOngoing:"authOngoing"},eb={audio:"audio",video:"video",data:"data",screen:"screen",multiplex:"multiplex",unbundled:"unbundled"},fb={local:"local",remote:"remote"},gb={excellent:5,good:4,fair:3,poor:2,bad:1},hb={local:"local",remote:"remote",inbound:"inbound",outbound:"outbound"},ib={excellent:3,fair:2,bad:1},jb={excellent:"excellent",fair:"fair",bad:"bad"},kb={established:"established",initializing:"initializing",failed:"failed",disrupted:"disrupted"},lb={createOffer:"createOffer",createAnswer:"createAnswer",setLocalDescription:"setLocalDescription",setRemoteDescription:"setRemoteDescription",addIceCandidate:"addIceCandidate",getUserMedia:"getUserMedia",iceConnectionFailure:"iceConnectionFailure",signalingError:"signalingError",applicationError:"applicationError",applicationLog:"applicationLog"},mb={mediaConfigError:"MediaConfigError",negotiationFailure:"NegotiationFailure",sdpError:"SDPGenerationError",iceFailure:"IceConnectionFailure",transportFailure:"TransportFailure",signalingError:"SignalingError",applicationError:"ApplicationError",applicationLog:"ApplicationLog"},nb={video:{gThreshold:1024,rThreshold:256},audio:{gThreshold:30,rThreshold:8}},ob={video:{gThreshold:.8,rThreshold:.3}},pb={video:{gThreshold:400,rThreshold:1e3}},qb={video:{gThreshold:10,rThreshold:50},audio:{gThreshold:15,rThreshold:30}},rb={audio:{gThreshold:240,rThreshold:400}},sb={chrome:"Chrome",firefox:"Firefox",edge:"Edge"},tb={unknown:"unknown",audio:"audio",video:"video"},ub=[_a.userJoined,_a.refreshPresence,$a.fabricSetupFailed,$a.applicationErrorLog],vb=function(a,b){window&&window.localStorage&&window.localStorage.setItem(a,b)},wb=function(a){return window&&window.localStorage?window.localStorage.getItem(a):null},xb=function(a){window&&window.localStorage&&window.localStorage.removeItem(a)},yb=function(a,b){var d=null,e=null,f=null,g=new XMLHttpRequest;g&&(g.open("GET",encodeURI(a)),d=c(),g.onload=function(){e=c(),f=e-d,b(g,f)},g.send())},zb=function(a,b,c){var d=new XMLHttpRequest;d&&(d.open("POST",encodeURI(a)),d.setRequestHeader("Content-Type","application/json"),d.onload=function(){c(d)},d.send(b))},Ab=function(a,b,c,d){var e=pa+"generics",f={appID:a,userID:encodeURIComponent(b),version:ra,eventType:c,data:d};zb(e,JSON.stringify(f),function(a){200===a.status||200!==a.status})};window.addEventListener("error",function(a){if(a&&a.filename&&a.filename.indexOf("callstats")>-1){var b,c=!1,d={fileName:a.filename,line:a.lineno,col:a.colno,jsVersion:ra,eventType:"error",message:a.message,pageURL:window.location.href};for(b in Oa)Oa.hasOwnProperty(b)&&(d.conferenceID=b,Ab(va,wa,"onErrorLog",d),c=!0);c||Ab(va,wa,"onErrorLog",d)}});var Bb={invalidWebRTCFunctionName:"Invalid WebRTC function name"},Cb={RETRY:0,GET_NEW_TOKEN:1,REPORT_ERROR:2},Db="fabricSetupFailed error reported by the developer",Eb="Connectivity Failure",Fb=b(),Gb=function(a,b,c,e){if(!Ja.authToken)return void Ja.sendAuthenticationRequest(va,wa);if(!Ra){var f,g,h,i,j=d(),l=[],m=Math.max(Ea/Sa.length,Ya);for(f=0;f<Sa.length;f++)if(h=Sa[f],h.data.action!==_a.userJoined){if(h.data.token=Ja.authToken,a&&h.data.apiTS>=j-b||!h.data.ucID)if(i=decodeURIComponent(h.data.conferenceID),Oa[i]&&Oa[i].ucID)h.data.ucID=Oa[i].ucID;else{if(i!==c){l.push(Sa[f]);continue}h.data.ucID=e}if(h.data.clockUnsynced&&(h.data.apiTS+=Qa.currentOffset),h.channel===ab.processedStats&&h.data.clockUnsynced&&h.data.processedStatistics&&h.data.processedStatistics.length>0)for(g=0;g<h.data.processedStatistics.length;g++)h.data.processedStatistics[g].apiTS+=Qa.currentOffset;delete h.data.clockUnsynced,k(h,m*(f+1))}else l.push(Sa[f]);Sa=l}},Hb=function(){if(!Ja.authToken)return void Ja.sendAuthenticationRequest(va,wa);var a,b,c=[],d=Math.max(Ea/Sa.length,Ya);for(a=0;a<Sa.length;a++)b=Sa[a],b.data.action===_a.userJoined||b.data.action===$a.fabricSetupFailed?(b.data.token=Ja.authToken,b.data.clockUnsynced&&(b.data.apiTS=b.data.apiTS+Qa.currentOffset),b.data.value&&(b.data.value.statsSubmissionInterval=Ea),k(b,d*(a+1))):c.push(Sa[a]);Sa=c},Ib=function(a){Sa.push(a)},Jb=function(a,b){var e=RegExp.prototype.test.bind(/^([a-z])=(.*)/),f=/^ssrc:(\d*) ([\w_]*):(.*)/,g=/^ssrc-group:SIM (\d*)/;a.split(/(\r\n|\r|\n)/).filter(e).forEach(function(a){var e=a[0],h=a.slice(2);if("a"===e){if(f.test(h)){var i=h.match(f),j=i[1];void 0===Ta[j]&&(Ta[j]={}),Ta[j][i[2]]=i[3],Ta[j].localStartTime=c(),Ta[j].syncedStartTime=d(),Ta[j].streamType=b}g.test(h)&&(void 0===Ta.ssrcGroup&&(Ta.ssrcGroup={},Ta.ssrcGroup[b]={}),Ta.ssrcGroup[b].simulcastGroup=h.match(/\d+/g))}})},Kb=function(a){return Ta[a]},Lb=function(){return Ta},Mb=function(a,b,c,d,e,f){if(!e.localDescription||!e.remoteDescription)return!1;var g=e.localDescription.sdp,h=e.remoteDescription.sdp;if(!g||!h||g===d.localSDP&&h===d.remoteSDP)return!1;if(Jb(g,hb.outbound),Jb(h,hb.inbound),Fa){var i={sdp:{}};i.sdp.localSDP=g!==d.localSDP?g:-1,i.sdp.remoteSDP=h!==d.remoteSDP?h:-1,Ob(a,b,c,i,d.pcHash,f)}return d.localSDP=g,d.remoteSDP=h,!0},Nb=function(a,b,c,e,f,g,h){if(!a)return void console.error("sendEvent: Invalid eventType ");var i=d(),j={version:ra,apiTS:i,action:a,localID:encodeURIComponent(wa),remoteID:encodeURIComponent(b),conferenceID:encodeURIComponent(c),timeShift:0,appID:va,ucID:e,pcID:g,deviceID:ya,value:f};return null===b&&(j.remoteID=null),null===c?void Ab(va,wa,"log",{msg:"conferenceID is null in sendEvent for "+a}):void(e&&!Ra||a===_a.userJoined||a===$a.fabricSetupFailed||a===_a.refreshPresence?(j.token=Ja.authToken,fa(ab.callStatsEvent,j,h)):(j.clockUnsynced=Ra,a!==_a.fabricStatsCaching&&a!==_a.refreshPresence&&Ib({channel:ab.callStatsEvent,data:j,callback:h})))},Ob=function(a,b,c,e,f,g){var h=d(),i={version:ra,appID:va,conferenceID:encodeURIComponent(b),ucID:c,apiTS:h,localID:encodeURIComponent(wa),remoteID:encodeURIComponent(a),pcID:f,deviceID:ya,sdpPayload:e};Ja.authToken&&c&&!Ra?(i.token=Ja.authToken,fa(ab.sdpSubmission,i,g)):(i.clockUnsynced=Ra,Ib({channel:ab.sdpSubmission,data:i,callback:g}))},Pb=function(a){var b={ucID:Oa[a].ucID,magicKey:Fb,endpoint:Na,fabricState:{},connectedDevices:la},c=Oa[a];if(la||i(),c&&c.participants){var d,e=c.participants,f=0;for(f=0;f<e.length;f++)d=e[f],b.fabricState[f]={pc:d.pcHash,userId:d.remoteUserID,pcState:d.pcState,iceConnectionState:d.pc.iceConnectionState,iceGatheringState:d.pc.iceGatheringState,iceCandidatesNumber:d.iceCandidates.length,numNegotiationNeededCalls:d.numNegotiationNeededCalls}}Ra||(b.clockSyncOffset=Qa.currentOffset),Nb(_a.refreshPresence,null,a,Oa[a].ucID,b,null)},Qb=function(){var a={appID:va,userID:encodeURIComponent(wa),version:ra,endpoint:Na,pagePerf:Ma,endpointID:ya,action:"registerPresence",channel:ab.registerPresence};-1!==va&&Ja.authToken&&(a.token=Ja.authToken,Ec(ab.registerPresence,"registerPresence",a))},Rb=function(){var a=wb("feedback"),b=JSON.parse(wb("csio_auth_data"));if(a&&b){var c=JSON.parse(a);if(!c)return;var d=b===c.token?!0:!1;d||wa!==c.userID||(c.token=b,d=!0),d?fa(ab.userFeedback,c):xb("feedback")}},Sb=function(a,b){var c={};return c.status=a,b&&(c.message=b),c},Tb=function(a,b){var c,d,e,f=0;for(c=0,e=a.length;e>c;c++)d=a.charCodeAt(c),f=(f<<5)-f+d,f|=0;return b&&b(f),f},Ub=function(a,b,d,e,f,g){if(!a||!d||!b)return console.error("initialize: Argument missing/invalid"),Sb(bb.failure,"initialize: Argument missing/invalid");if("function"!=typeof b){if(!(window.crypto&&(window.crypto.subtle||window.crypto.webkitSubtle)||window.msCrypto&&window.msCrypto.subtle))return e(cb.tokenGenerationError,"Browser does not support Web Cryptography API. App secret based authentication requires Web Cryptography API"),Sb(bb.failure,"Browser does not support Web Cryptography API. App secret based authentication requires Web Cryptography API");b=Ja.appSecretTokenGenerator(b)}if("string"==typeof a&&(a=parseInt(a,10)),va=a,"object"==typeof d?(wa=d.aliasName,xa=d):wa=d,Ab(va,wa,"log",{msg:"callstats initialize in progress"}),Ja.tokenGenerator=b,wb("csio_auth_data"))try{var h=JSON.parse(wb("csio_auth_data"));Ja._isTokenValid(h,va,wa)&&(e&&e(cb.success,"SDK authentication successful."),Ja.setupAuthToken(h),Dc._isChannelReady()||Dc._setupWebSocketConnection(e))}catch(k){}if(g&&(g.disableBeforeUnloadHandler===!0&&(za=!0),(null!==g.applicationVersion||void 0!==g.applicationVersion)&&(Na.appVer=g.applicationVersion)),j(),ya=wb("endpointID"),null===ya){var l=c(),m=Math.random()*l;mc(m.toString(),function(a){ya=a,vb("endpointID",ya)})}return i(),na=f,Ja.sendAuthenticationRequest(va,wa,e),Sb(bb.success)},Vb=function(a){return function(b){return b.remoteUserID===a?!0:void 0}},Wb=function(a,b){var c=!1,d=null;return Oa[a]&&Oa[a].participants&&(d=Oa[a].participants.filter(Vb(b))),c=d&&d.length>0?!0:!1},Xb=function(a){return function(b){return b.pc===a?!0:a.callstatsID&&b.pcHash===a.callstatsID?!0:void 0}},Yb=function(a,b){var c=null,d=null;return Oa[a]&&Oa[a].participants&&(d=Oa[a].participants.filter(Xb(b))),c=d&&d.length>0?d[0]:null},Zb=function(a,b){var c=null,d=null;return c=Yb(a,b),c&&(d=c.pcHash),d},$b=function(a){var b=null,c=null,d=null;for(b in Oa)if(Oa.hasOwnProperty(b)&&(d=Yb(b,a))){c={fabric:d,conferenceID:b};break}return c},_b=function(a,b){var c=0;if(a&&Oa[b].participants)for(c=0;c<Oa[b].participants.length;c++)if(Oa[b].participants[c].pcHash===a.pcHash){Oa[b].participants.splice(c,1);break}},ac=function(a){var b=La.codebase,c=null,d=0;if(b===sb.firefox&&"Safari"!==La.name)c=[],a.forEach(function(a){c.push(a)});else if(b===sb.chrome&&"Safari"!==La.name)a&&(c=a.result());else{c=[];for(d in a)a.hasOwnProperty(d)&&c.push(a[d])}return c},bc=function(a){var b=null,c=null,d=null,e=[],f=[],g=0,h=La.codebase;if(b=ac(a),!b)return{localCandidates:e,remoteCandidates:f};for(g=0;g<b.length;++g)c=U(b[g]),d=R(JSON.parse(c),h),d.hasOwnProperty("localCandidate")?e.push(d.localCandidate):d.hasOwnProperty("remoteCandidate")&&f.push(d.localCandidate);return{localCandidates:e,remoteCandidates:f}},cc=function(a){function b(b){var c={};c=bc(b),a(c.localIceCandidates,c.remoteCandidates)}return b},dc=function(a,b,c,d,e,f,g,h){var i=La.codebase,j=La.name;i===sb.firefox||"Safari"===j?a.getStats(null,c(b,d,e,f,g,h,a),function(a){Ab(va,d,"log",{msg:"### "+i+" getStats reports error "+JSON.stringify(a)})}):i===sb.chrome?a.getStats(c(b,d,e,f,g,h,a)):i===sb.edge&&a.getStats().then(c(b,d,e,f,g,h,a))["catch"](function(a){Ab(va,d,"log",{msg:"### "+i+" getStats reports error "+JSON.stringify(a)})})},ec=function(a,b){dc(a,b,cc)},fc=function(a,b,d,e){if(!a||!b||!d)return console.error("sendFabricEvent: Arguments missing/Invalid"),Sb(bb.failure,"sendFabricEvent: Arguments missing/Invalid");if(!va||!wa||!Oa[d])return console.error("sendFabricEvent: SDK is not initialized or no Fabrics added."),Sb(bb.failure,"sendFabricEvent: SDK is not initialized or no Fabrics added.");if(b===$a.fabricSetupFailed)return console.error("sendFabricEvent: Unsupported fabricEvent fabricSetupFailed"),Sb(bb.failure,"sendFabricEvent: Unsupported fabricEvent fabricSetupFailed");if(!o(a))return console.error("sendFabricEvent: Invalid PeerConnection object passed"),Sb(bb.failure,"sendFabricEvent: Invalid PeerConnection object passed");if(!$a.hasOwnProperty(b)&&!_a.hasOwnProperty(b))return console.error("sendFabricEvent: Invalid fabricEvents value: ",b),Sb(bb.failure,"sendFabricEvent: Invalid fabricEvents value: "+b);var f=null,g=null,h=c(),i=Oa[d],j=null;if(void 0===i)return console.error("sendFabricEvent: Conference ID not found!"),Sb(bb.failure,"sendFabricEvent: Conference ID not found!");if(j=Yb(d,a),null===j)return console.error("sendFabricEvent: fabricData is null"),Sb(bb.failure,"sendFabricEvent: fabricData is null");g=j.remoteUserID;var k=j.startTime;if(!(b===$a.fabricSetup||b===_a.autoFabricSetup&&j.fabricSetupSent)){if(b===_a.autoFabricSetup){var l=h-j.startTime;if(f={setupDelay:l,iceCandidates:j.iceCandidates,iceGatheringDelay:j.gatheringIceCandidatesDelay,iceConnectivityDelay:j.connectivityIceStatusDelay},j.iceCandidates&&0===j.iceCandidates.length)return void ec(a,function(a,c){f.localCandidates=a,f.remoteCandidates=c,j.localCandidates=a,j.remoteCandidates=c,j.pcState=kb.established,j.fabricSetupSent=!0,Nb(b,g,d,i.ucID,f,j.pcHash,j.pcCallback)});j.pcState=kb.established,j.fabricSetupSent=!0}else if(b===_a.autoFabricSetupFailed)f={failureDelay:j.setupFailureTime,reason:mb.iceFailure,domError:Eb};else if(b===_a.fabricDisrupted)f={disruptionDelay:j.connectivityIceStatusDelay};else if(b===_a.updatedConfiguration)f=j.transportData;else if(b===$a.fabricSetupFailed){var m=h-k;f={failureDelay:m,reason:mb.iceFailure,domError:Db,fabricState:j.pcState,iceConnectionState:j.pc.iceConnectionState,"function":lb.iceConnectionFailure,magicKey:Fb,endpoint:Na}}else if(b===$a.activeDeviceList){if(!e||!e.deviceList)return console.error("sendFabricEvent: Arguments missing/Invalid"),Sb(bb.failure,"sendFabricEvent: Arguments missing/Invalid");f={magicKey:Fb,endpoint:Na,activeDevicelist:e.deviceList}}if(Nb(b,g,d,i.ucID,f,j.pcHash,j.pcCallback),(b===$a.fabricTerminated||b===_a.autoFabricSetupFailed||b===$a.fabricSetupFailed)&&Oa[d].participants){j&&(j.statsInterval=Z(j.statsInterval),_b(j,d));var n=ba(d);n.conferenceFinished&&ca(d,n.ucID)}if((b===$a.fabricSetup||b===$a.fabricUsageEvent)&&!j.fabricUsageSent){var p=j.fabricUsage;j.fabricUsageSent=!0,Nb($a.fabricUsageEvent,g,d,i.ucID,p,j.pcHash,null)}return Sb(bb.success)}},gc=function(a){return a.length>Da&&(console.log("Log exceeds 20kb, It will be truncated"),a=a.substring(0,Da)),a},hc=function(a){return a&&"string"==typeof a?a=gc(a):a&&"object"==typeof a&&a.hasOwnProperty("message")&&(a.message=gc(a.message)),a},ic=function(a,b,c){return b?b:a&&a[c]?a[c].sdp:-1},jc=function(a,d,e,f,g,h){if(void 0===a||!e||!d)return console.error("reportError: Arguments missing/invalid"),Sb(bb.error,"reportError: Arguments missing/invalid");if(!va||!wa)return console.error("reportError: SDK is not initialized"),Sb(bb.error,"reportError: SDK is not initialized");if(!lb.hasOwnProperty(e))return console.error("reportError: Invalid webRTC functionName value: %o",e),Sb(bb.error,"reportError: Invalid webRTC functionName value: "+e);void 0===f&&console.warn("reportError: Missing dom error parameter");var i,j=null,k=null,l=c(),m=Oa[d],n=null;if(i=Q(e),f&&f instanceof DOMException)f={message:f.message,name:f.name};else if(f&&"object"==typeof f){var p={};f.hasOwnProperty("message")&&(p.message=f.message),f.hasOwnProperty("name")&&(p.name=f.name),f.hasOwnProperty("constraintName")&&(p.constraintName=f.constraintName),f.hasOwnProperty("stack")&&(p.stack=f.stack),f=p}if(f=hc(f),o(a)){if(void 0===m)return console.error("reportError: Conference ID not found!"),Sb(bb.error,"reportError: Conference ID not found!");if(n=Yb(d,a),null===n)return console.error("reportError: Invalid pcObject passed as argument"),Sb(bb.error,"reportError: Invalid pcObject passed as argument");k=n.remoteUserID;var q=n.startTime,r=l-q;if(j={failureDelay:r,reason:i,domError:f,fabricState:n.pcState,iceConnectionState:n.pc.iceConnectionState,"function":e,magicKey:Fb,endpoint:Na},e===lb.applicationLog||e===lb.applicationError?Nb($a.applicationErrorLog,k,d,m.ucID,j,n.pcHash,n.pcCallback):Nb($a.fabricSetupFailed,k,d,m.ucID,j,n.pcHash,n.pcCallback),g||h||a&&a.localDescription||a&&a.remoteDescription){var s={sdp:{}};s.sdp.localSDP=ic(a,g,"localDescription"),s.sdp.remoteSDP=ic(a,h,"remoteDescription"),Ob(k,d,m.ucID,s,n.pcHash)}}else{null===Fb&&(Fb=b());var t=b();j={failureDelay:0,reason:i,domError:f,"function":e,magicKey:Fb,endpoint:Na},e===lb.applicationLog||e===lb.applicationError?Nb($a.applicationErrorLog,k,d,null,j,null,null):Nb($a.fabricSetupFailed,k,d,null,j,t,null)}return Sb(bb.success)},kc=function(a){for(var b=[],c=0;c<a.length;c++){var d=a.charCodeAt(c);128>d?b[b.length]=d:d>127&&2048>d?(b[b.length]=d>>6|192,b[b.length]=63&d|128):(b[b.length]=d>>12|224,b[b.length]=d>>6&63|128,b[b.length]=63&d|128)}return new Uint8Array(b).buffer},lc=function(a){for(var b,c=new DataView(a),d="",e=0;e<c.byteLength;e++)b=c.getUint8(e).toString(16),b.length<2&&(b="0"+b),d+=b;return d},mc=function(a,b){var c={name:"SHA-256"};if(window.crypto){var d=window.crypto.subtle||window.crypto.webkitSubtle;if(!d)return void Tb(a,b);d.digest(c,kc(a)).then(function(a){b(lc(a))})["catch"](function(){Tb(a,b)})}else if(window.msCrypto){if(!window.msCrypto.subtle)return void Tb(a,b);var e=window.msCrypto.subtle.digest(c,kc(a));e.oncomplete=function(a){a.target&&b(lc(a.target.result))},e.onerror=function(){Tb(a,b)}}else Tb(a,b)},nc=function(a,b,c){var d;if(!b||!a)return console.error("sendUserFeedback: Arguments missing/Invalid"),Sb(bb.error,"sendUserFeedback: Arguments missing/Invalid");if("object"!=typeof b)return console.error("sendUserFeedback: Invalid feedback object."),Sb(bb.error,"sendUserFeedback: Invalid feedback object.");if(0===Object.keys(b).length)return console.error("sendUserFeedback: Feedback data object must not be empty."),Sb(bb.error,"sendUserFeedback: Feedback data object must not be empty.");if(!b.hasOwnProperty("overall"))return console.error("sendUserFeedback: Feedback data object must contain 'conferenceID', 'userID' and 'overall' keys."),Sb(bb.error,"sendUserFeedback: Feedback data object must contain 'conferenceID', 'userID' and 'overall' keys.");var e=Oa[a],f=null;void 0!==e&&void 0!==e.ucID&&(f=e.ucID);var g=null;if(g=null===Fb?Ua:Fb,null===f&&(f=ea(a)),null===f)return console.error("sendUserFeedback: ucID unavailable"),Sb(bb.error,"sendUserFeedback: ucID unavailable");d="object"==typeof b.userID?b.userID.aliasName:b.userID;var h={conferenceID:encodeURIComponent(a),magicKey:g,appID:va,version:ra,ucID:f,userID:encodeURIComponent(d),userQoe:{overall:b.overall}};return b.hasOwnProperty("video")?h.userQoe.video=b.video:h.userQoe.video=-1,b.hasOwnProperty("audio")?h.userQoe.audio=b.audio:h.userQoe.audio=-1,b.hasOwnProperty("screen")?h.userQoe.screen=b.screen:h.userQoe.screen=-1,b.hasOwnProperty("comment")?h.userQoe.comment=b.comment:h.userQoe.comment=-1,Ja.authToken&&!Ra?(h.token=Ja.authToken,vb("feedback",JSON.stringify(h)),fa(ab.userFeedback,h,c)):(h.clockUnsynced=Ra,Ib({channel:ab.userFeedback,data:h,callback:c})),Sb(bb.success)},oc=function(a,b,c,d,e,f){var g=null;if(g="object"==typeof b?b.aliasName:b,!(a&&c&&g&&d&&e))return console.error("associateMstWithUserID: Arguments missing"),Sb(bb.error,"associateMstWithUserID: Arguments missing");if(""===c||""===g||""===d||""===e)return console.error("associateMstWithUserID: conferenceID or remoteUserID or ssrc MUST not be empty"),Sb(bb.error,"associateMstWithUserID: conferenceID or remoteUserID or ssrc MUST not be empty");if(!o(a))return console.error("associateMstWithUserID: Invalid PeerConnection object passed"),Sb(bb.error,"associateMstWithUserID: Invalid PeerConnection object passed");var h=Oa[c];if(void 0===h)return console.error("associateMstWithUserID: conferenceID doesn't exist"),Sb(bb.error,"associateMstWithUserID: conferenceID doesn't exist");var i=null;if(i=Yb(c,a),null===i)return console.error("associateMstWithUserID: Unknown pcObject passed"),Sb(bb.error,"associateMstWithUserID: Unknown pcObject passed");var j=Kb(d);return void 0===j&&(Ta[d]={},j=Kb(d)),j.remoteUserID=g,j.ssrc=d,j.associatedVideoTag=f,j.usageLabel=e,f&&g!==wa&&n(g,c,f,a,d),Sb(bb.success)},pc=function(a,d,e,f,g){var h=null,i={authStatus:Ja.tokenData?!0:!1,clockSync:!Ra,msg:"addNewFabric called",eventType:"warn",pageURL:window.location.href,conferenceID:f,version:ra};if(Ab(va,wa,"stateMachine",i),h="object"==typeof d?d.aliasName:d,!(a&&h&&e&&f))return console.error("addNewFabric: Arguments missing/Invalid"),Sb(bb.error,"addNewFabric: Arguments missing/Invalid");if(!va||!wa)return console.error("addNewFabric: SDK not initialized."),Sb(bb.error,"addNewFabric: SDK not initialized");if(""===f||""===h)return console.error("addNewFabric: conferenceID or remoteUserID MUST not be empty"),Sb(bb.error,"addNewFabric: conferenceID or remoteUserID MUST not be empty");if(!o(a))return console.error("addNewFabric: Invalid PeerConnection object passed"),Sb(bb.error,"addNewFabric: Invalid PeerConnection object passed");if(!eb.hasOwnProperty(e)||e instanceof Function)return console.error("addNewFabric: Invalid fabricUsage value"),Sb(bb.error,"addNewFabric: Invalid fabricUsage value");var j=c();null===Fb&&(Fb=b());var k=null,l=!1;if(!_(f)){var m=W(Fb);Nb(_a.userJoined,null,f,null,m,null,null),l=!0,i={authStatus:Ja.tokenData?!0:!1,clockSync:!Ra,msg:"userJoined sent",pageURL:window.location.href,eventType:"warn",conferenceID:f,version:ra},Ab(va,wa,"stateMachine",i)}if(X(f,k,l),!Yb(f,a)){a.addEventListener&&(a.addEventListener("icecandidate",vc,!1),a.addEventListener("iceconnectionstatechange",uc,!1),a.addEventListener("signalingstatechange",rc,!1),a.addEventListener("negotiationneeded",tc,!1));var n=b(),p={pc:a,remoteUserID:h,fabricUsage:e,magicKey:Fb,startTime:j,pcCallback:g,pcState:kb.initializing,fabricSetupSent:!1,iceCandidates:[],iceConnectionState:a.iceConnectionState,latestEventSent:j,pcHash:n,localSDP:-1,remoteSDP:-1,statsInterval:null,initialPhaseOver:!1,intervalAdaptionPhase:!0,gatheringIceCandidatesDelay:0,connectivityIceStatusDelay:0,numNegotiationNeededCalls:0};"function"!=typeof a||a.callstatsID||(a.callstatsID=n),("connected"===a.iceConnectionState||"completed"===a.iceConnectionState)&&(p.pcState=kb.established),aa(f,p),p.pcState===kb.established&&(fc(a,_a.autoFabricSetup,f),sc(p,a,f,h))}return Sb(bb.success)},qc=function(a,b,c,d){if(!(a&&c&&d&&b))return console.error("reportUserIDChange: Arguments missing/Invalid"),Sb(bb.error,"reportUserIDChange: Arguments missing/Invalid");if(!va||!wa)return console.error("reportUserIDChange: SDK not initialized."),Sb(bb.error,"reportUserIDChange: SDK not initialized");if(""===c||""===b)return console.error("reportUserIDChange: id or  conferenceID MUST not be empty"),Sb(bb.error,"reportUserIDChange: id or  conferenceID MUST not be empty");if(!o(a))return console.error("reportUserIDChange: Invalid PeerConnection object passed"),Sb(bb.error,"reportUserIDChange: Invalid PeerConnection object passed");var e,f=null,g=Oa[b];if(void 0===g)return console.error("reportUserIDChange: Conference ID not found!"),Sb(bb.error,"reportUserIDChange: Conference ID not found!");var h=null;if(void 0===g.ucID)return console.error("reportUserIDChange: addNewFabric was not called"),Ab(va,wa,"log",{msg:"### reportUserIDChange: addNewFabric was not called"}),Sb(bb.error,"reportUserIDChange: addNewFabric was not called");if(h=g.ucID,f=Yb(b,a),null===f)return console.error("reportUserIDChange: Invalid pcObject passed as argument"),Sb(bb.error,"reportUserIDChange: Invalid pcObject passed as argument");var i={id:c,idType:d};return Nb($a.userIDChangedEvent,e,b,h,i,null,f.pcCallback),Sb(bb.success)},rc=function(a){if(a){var b,c=La.codebase,d=null;if(c===sb.firefox)b=a.target;else if(c===sb.chrome)b=a.srcElement;else{if(c!==sb.edge)return void console.error("PeerConnection signaling state changed: unsupported code base");b=a.pc}if(void 0!==b){var e=b.signalingState;"closed"===e&&(d=$b(b),d&&d.fabric&&fc(b,$a.fabricTerminated,d.conferenceID))}}},sc=function(a,b,d,e){null===a.statsInterval&&(a.statsPollingStart=c(),wc(b,d,e),a.statsInterval=setInterval(wc,Pa.statsSubmissionIntervalInMS[Pa.currentActivePhaseIndex],b,d,e))},tc=function(a){if(a){var b,c=La.codebase;if(c===sb.firefox)b=a.target;else if(c===sb.chrome)b=a.srcElement;else{if(c!==sb.edge)return void console.error("PeerConnection negotiation needed: unsupported code base");b=a.pc}if(void 0!==b){var d=null;d=$b(b),d&&d.fabric&&d.fabric.numNegotiationNeededCalls++}}},uc=function(a){if(a){var b,d=La.codebase;if(d===sb.firefox)b=a.target;else if(d===sb.chrome)b=a.srcElement;else{if(d!==sb.edge)return void console.error("PeerConnection ICE connection state changed: unsupported code base");b=a.pc}if(void 0!==b){var e,f,g,h,i=null,j=null;j=$b(b),j&&j.fabric&&(i=j.fabric,e=j.conferenceID,f=i.remoteUserID,g=c(),h=g-i.startTime,"complete"===b.iceGatheringState&&"checking"===b.iceConnectionState&&(i.gatheringIceCandidatesDelay=h),"connected"===b.iceConnectionState||"completed"===b.iceConnectionState?(i.connectivityIceStatusDelay=h,i.pcState===kb.initializing?i.fabricSetupSent||fc(i.pc,_a.autoFabricSetup,e):i.pcState===kb.disrupted&&fc(i.pc,_a.fabricDisrupted,e),i.pcState=kb.established,sc(i,b,e,f)):"failed"===b.iceConnectionState?(i.setupFailureTime=h,fc(i.pc,_a.autoFabricSetupFailed,e),i.pcState=kb.failed):"disconnected"===b.iceConnectionState&&(i.startTime=c(),i.pcState=kb.disrupted,i.pcCallback&&i.pcCallback(cb.appConnectivityError,"Connectivity check for PC object to "+f+" failed.")),i.iceConnectionState=b.iceConnectionState)}}},vc=function(a){var b,c,d;if(null!==a.candidate){var e=a.candidate.candidate;c=e.split(" ");var f="1"===c[1]?"rtp":"rtcp";"0"!==c[5]&&(d=-1!==c[4].indexOf(":"),b={transport:c[2],protocol:f,typePreference:c[3],address:d?"["+c[4]+"]:"+c[5]:c[4]+":"+c[5],type:c[7],media:a.candidate.sdpMid})}var g,h=La.codebase;if(h===sb.firefox)g=a.target;else if(h===sb.chrome)g=a.srcElement;else{if(h!==sb.edge)return void console.error("PeerConnection ICE candidate found: unsupported code base");g=a.pc}if(void 0!==g){var i=null;i=$b(g),i&&i.fabric&&void 0!==b&&-1===i.fabric.iceCandidates.indexOf(b)&&i.fabric.iceCandidates.push(b)}},wc=function(a,b,d){if(!Oa.hasOwnProperty(b))return void console.error("ConferenceID %o doesn't exist. Can't call getStats for it.",b);if(!Wb(b,d))return void console.error("Remote user ID %o doesn't exist. Can't call getStats for it.",d);if("closed"===a.signalingState)return fc(a,$a.fabricTerminated,b),!0;var e=Yb(b,a);if(e.pcState!==kb.established&&e.lastFabricState===e.pcState&&"connected"!==a.iceConnectionState&&"completed"!==a.iceConnectionState)return!0;var f=Oa[b].ucID;dc(a,e.pcCallback,P,wa,d,b,f,e);var g,h=c(),i=h-e.statsPollingStart,j=5e3;(i>Pa.statsSubmissionPhaseDurationInMS[Pa.currentActivePhaseIndex]&&e.intervalAdaptionPhase||Aa===!0)&&(Z(e.statsInterval),Aa?(g=Ba,e.intervalAdaptionPhase=!1,Aa=!1):Pa.currentActivePhaseIndex<Pa.statsSubmissionIntervalInMS.length-1?(Pa.currentActivePhaseIndex+=1,g=Pa.statsSubmissionIntervalInMS[Pa.currentActivePhaseIndex]):(g=Ea,e.intervalAdaptionPhase=!1),g>j&&(e.initialPhaseOver=!0),e.statsInterval=setInterval(wc,g,a,b,d))},xc=function(a,b,c){b.hasOwnProperty(a)&&(b[a].hasOwnProperty("video")&&(b[a].video.isGreaterBetter?(c.video.gThreshold=b[a].video.upperThreshold,c.video.rThreshold=b[a].video.lowerThreshold):(c.video.gThreshold=b[a].video.lowerThreshold,c.video.rThreshold=b[a].video.upperThreshold)),b[a].hasOwnProperty("audio")&&(b[a].audio.isGreaterBetter?(c.audio.gThreshold=b[a].audio.upperThreshold,c.audio.rThreshold=b[a].audio.lowerThreshold):(c.audio.gThreshold=b[a].audio.lowerThreshold,c.audio.rThreshold=b[a].audio.upperThreshold)))},yc=function(a,b,c){var d=[];for(var e in b)b.hasOwnProperty(e)&&d.push(encodeURIComponent(e)+"="+encodeURIComponent(b[e]));var f=d.join("&"),g=new XMLHttpRequest;g.open("POST",a),g.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),g.onload=function(){c(g)},g.send(f)},zc=function(){yb(ua,function(a){if(200===a.status)try{var b=JSON.parse(a.responseText);xc("eModelThreshold",b,rb),xc("throughputThreshold",b,nb),xc("fractionalLossThreshold",b,qb),xc("rttThreshold",b,pb),xc("currOverPrevFrameRateThreshold",b,ob)}catch(c){return c}})},Ac=function(){var a=pa+"clockSync",b=null,d=null;yb(a,function(a,e){200===a.status&&(b=JSON.parse(a.response),d=c(),Bc(b,e,d))})},Bc=function(a,b,c){if(Ra){var d=b/2;if(d>Qa.maxAllowedLatency)Qa.offsetResults=[],Ab(va,wa,"log",{msg:"clockSync restarting"});else{var e=a.now+d,f=e-c;Qa.offsetResults.push(f)}if(Qa.offsetResults.length>=Qa.syncAttempts){var g=Qa.offsetResults.reduce(function(a,b){return a+b});Qa.currentOffset=g/Qa.offsetResults.length,Qa.offsetResults=[],Ra=!1,Ab(va,wa,"log",{msg:"clockSync Done"}),Hb(),Gb()}else Ra&&setTimeout(function(){Ac()},100)}},Cc=function(){var a=this,b=null,d=!1,e=!1,f={},g={initiated:"initiated",connected:"connected",closed:"closed"};this._wsConnectionState=g.closed;var h=function(a,b){var c=JSON.parse(window.sessionStorage.getItem("csio_ucid_data"));c||(c={}),c[a]||(c[a]={}),c[a].ucID=b,window.sessionStorage.setItem("csio_ucid_data",JSON.stringify(c)),f[a]=ta+va+"/conferences/"+encodeURIComponent(a)+"/"+b+"/general"};this.getConferenceURL=function(){return f},this._setupWebSocketConnection=function(f){return a._wsConnectionState===g.initiated||a._wsConnectionState===g.connected?(Ab(va,wa,"log",{msg:"### _setupWebSocketConnection is called when already connected!"}),void(f&&f(cb.success,"WebSocket establishment successful."))):(a._wsConnectionState=g.initiated,b=new WebSocket(sa,"echo-protocol"),b.onopen=function(){Ab(va,wa,"log",{msg:"Successfully connected to the backend"}),a._wsConnectionState=g.connected,d?e=!0:d=!0,Qa.syncHandler||(Ab(va,wa,"log",{msg:"start clockSync"}),Qa.offsetResults=[],Ac(),Qa.syncHandler=!0),Hb(),e?(da(),Gb()):Qb(),e=!1},b.onclose=function(){a._wsConnectionState=g.closed,Ab(va,wa,"log",{msg:"Connection to the server closed."}),$(),Ra&&(Qa.offsetResults=[],Qa.syncHandler=null,Ra=!1),b&&(b=null),f&&f(cb.httpError,"Connection to the server closed.")},b.onerror=function(b){a._wsConnectionState=g.closed,Ab(va,wa,"log",{msg:"WebSocket establishment failed."}),f&&f(cb.wsChannelFailure,"WebSocket establishment failed.",b)},void(b.onmessage=function(a){var b,d=a.data,e=c(),g=JSON.parse(d);if("Error"===g.status)"Invalid client token."===g.reason&&(Ja.tokenData=null,Ja.authToken=null,Ja.sendAuthenticationRequest(va,wa)),f&&f(cb.csProtoError,d.reason);else if("200 OK"===g.status)if("feedback"===g.event)window.localStorage.removeItem("feedback");else if(g.event===_a.userJoined||g.event===_a.refreshPresence){var i=!1,j=null;b=decodeURIComponent(g.conferenceID);var k=function(a){return setInterval(function(){Pb(a)},Ga)};Oa.hasOwnProperty(b)&&(Oa[b].ucID!==g.ucID&&(i=!0,h(b,g.ucID),j=g.conferenceCreationTS?g.conferenceCreationTS:g.conferenceDuration),g.event!==_a.userJoined||Oa[b].refreshPresence||(Oa[b].refreshPresence=k(b),ka()),Oa[b].ucID=g.ucID),Rb(),Gb(i,j,b,g.ucID)}else g.event===ab.clockSync?Bc(g,e):g.event===$a.fabricSetupFailed&&(b=decodeURIComponent(g.conferenceID),g.ucID&&(h(b,g.ucID),Rb(),Gb(!0,0,b,g.ucID)))}))},this._isChannelReady=function(){return b&&1===b.readyState?!0:!1},this.getWSConnectionState=function(){return b?b.readyState:-1},this.send=function(a){b.send(JSON.stringify(a))}},Dc=new Cc,Ec=function(a,b,c){if(Dc._isChannelReady())try{Dc.send(b)}catch(d){d&&"InvalidStateError"===d.name&&Ib({channel:a,data:b,callback:c})}else Ib({channel:a,data:b,callback:c}),Dc._setupWebSocketConnection()};return f(),zc(),Ac(),ja(),{version:ra,initialize:Ub,fabricEvent:$a,addNewFabric:pc,sendFabricEvent:fc,sendUserFeedback:nc,associateMstWithUserID:oc,csError:cb,fabricUsage:eb,qualityRating:gb,webRTCFunctions:lb,reportError:jc,reportUserIDChange:qc,userIDType:fb,callStatsAPIReturnStatus:bb}}"function"==typeof define&&define.amd?define("callstats",[],c):b.callstats=c}("undefined"!=typeof window?window:"undefined"!=typeof b?b:this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./callstatsUtils":2}],2:[function(a,b,c){"use strict";function d(){}d.prototype.measureAppLoadingPerformance=function(a){var b=0,c=Number.MAX_VALUE,d=0,e="",f="",g=window.performance;if(!("performance"in window&&"timing"in window.performance&&"navigation"in window.performance))return{
support:"none",total:void 0};var h=g.timing.loadEventEnd-g.timing.navigationStart;if("Chrome"===a.name||"Opera"===a.name){var i,j=g.getEntriesByType("resource");for(i=0;i<j.length;i++)j[i].duration>d&&(f=j[i].name.substr(j[i].name.lastIndexOf("/")+1),d=j[i].duration),j[i].duration<c&&(e=j[i].name.substr(j[i].name.lastIndexOf("/")+1),c=j[i].duration),j[i].name.indexOf("CALLSTATS_SRC_URLstatic/callstats")>-1&&(b=j[i].duration);return{support:"full",callstats:b,min:{name:e,time:c},max:{name:f,time:d},total:h}}return"Firefox"===a.name?{support:"limited",total:h}:void 0},d.prototype.detectBrowserInfo=function(){var a,b,c=navigator.userAgent,d=navigator.appName,e=navigator.appVersion,f=""+parseFloat(navigator.appVersion),g={goog:"Chrome",moz:"Firefox",plugin:"Plugin",edge:"Edge"};-1!==(a=c.indexOf("Opera"))?(d="Opera",f=c.substring(a+6),-1!==(a=c.indexOf("Version"))&&(f=c.substring(a+8)),b=g.goog):-1!==(a=c.indexOf("OPR"))?(d="Opera",f=c.substring(a+4),-1!==(a=c.indexOf("Version"))&&(f=c.substring(a+8)),b=g.goog):-1!==(a=c.indexOf("MSIE"))?(d="Microsoft Internet Explorer",f=c.substring(a+5),b=g.goog):-1!==(a=c.indexOf("Edge"))?(d=g.edge,f=c.substring(a+5),b=g.edge):-1!==(a=c.indexOf("Chrome"))?(d=g.goog,f=c.substring(a+7),b=g.goog):-1!==(a=c.indexOf("Safari"))?(d="Safari",f=c.substring(a+7),-1!==(a=c.indexOf("Version"))&&(f=c.substring(a+8)),b=g.goog):-1!==(a=c.indexOf("Firefox"))?(d="Firefox",f=c.substring(a+8),b=g.moz):-1!==(a=c.indexOf("Trident"))&&(d="Microsoft Internet Explorer",a=c.indexOf("rv"),f=c.substring(a+3,a+7),b=g.goog);var h,i,j=null,k=[{s:"Windows 3.11",r:/Win16/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 10",r:/(Windows 10|Windows NT 10.0)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows ME",r:/Windows ME/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(h in k)if(i=k[h],i.r.test(c)){j=i.s;break}var l=null;switch(/Windows/.test(j)&&(l=/Windows (.*)/.exec(j)[1],j="Windows"),j){case"Mac OS X":l=/Mac OS X (10[\.\_\d]+)/.exec(c)[1];break;case"Android":l=/Android ([\.\_\d]+)/.exec(c)[1];break;case"iOS":l=/OS (\d+)_(\d+)_?(\d+)?/.exec(e),l=l[1]+"."+l[2]+"."+(0|l[3])}return{name:d,ver:f.toString(),os:j,osVersion:l,codebase:b,userAgent:c}},b.exports=d},{}]},{},[1]);